# 2.3 Advanced Statistical Analysis with ANOVA - Quick Reference

## 📊 ANOVA Fundamentals

### Key Concept

**ANOVA partitions total variation**: `Total Variation = Between-Group + Within-Group`

### When to Use ANOVA

- ✅ Comparing means across 3+ groups
- ✅ Testing effects of categorical factors
- ✅ Analyzing factorial experiments
- ❌ Only 2 groups (use t-test instead)
- ❌ Continuous predictors (use regression instead)

---

## 🔢 Essential Formulas

### One-Way ANOVA

```text
F = MSB/MSW = (SSB/(k-1))/(SSW/(N-k))

Where:
- SSB = Σnᵢ(ȳᵢ - ȳ)²  (Between groups)
- SSW = ΣΣ(yᵢⱼ - ȳᵢ)²  (Within groups)
- SST = SSB + SSW      (Total)
- k = number of groups
- N = total sample size
```

### Effect Size (Eta-squared)

```text
η² = SSB/SST
- Small: η² ≈ 0.01
- Medium: η² ≈ 0.06  
- Large: η² ≈ 0.14
```

### Two-Way ANOVA

```text
yᵢⱼₖ = μ + αᵢ + βⱼ + (αβ)ᵢⱼ + εᵢⱼₖ

Where:
- αᵢ = main effect of factor A
- βⱼ = main effect of factor B
- (αβ)ᵢⱼ = interaction effect
```

### Sample Size (Power Analysis)

```text
Required n per group ≈ 2σ²(zα/2 + zβ)²/δ²

Where:
- δ = minimum detectable difference
- σ = standard deviation
- zα/2, zβ = critical values for α and β
```

---

## 🎯 Assumptions Checklist

### ✅ Independence

- **Check**: Random sampling, no systematic bias
- **Test**: Durbin-Watson statistic (1.5 < DW < 2.5)
- **Fix**: Randomize order, block known sources

### ✅ Normality

- **Check**: Q-Q plots, histograms of residuals
- **Test**: Shapiro-Wilk (n < 5000), Anderson-Darling
- **Fix**: Transform data, use robust alternatives

### ✅ Homoscedasticity (Equal Variances)

- **Check**: Residuals vs fitted plot
- **Test**: Levene's test, Bartlett's test
- **Fix**: Transform data, Welch's ANOVA

### ✅ Linearity (Factorial Designs)

- **Check**: Interaction plots, residual patterns
- **Test**: Lack-of-fit test
- **Fix**: Add polynomial terms, transform variables

---

## 📈 Interpretation Guidelines

### F-Test Results

```text
If p < α (usually 0.05):
  → Reject H₀: "At least one group differs"
  → Proceed to post-hoc tests

If p ≥ α:
  → Fail to reject H₀: "No evidence of differences"
  → Check power, effect size
```

### Post-Hoc Tests

| **Method** | **When to Use** | **Control** |
|------------|-----------------|-------------|
| Tukey HSD | Equal group sizes, all pairwise | Family-wise error |
| Bonferroni | Unequal sizes, selected pairs | Family-wise error |
| Dunnett | Many-to-one comparisons | Family-wise error |
| Fisher LSD | Planned comparisons only | Per-comparison error |

### Interaction Interpretation

- **Parallel lines**: No interaction → interpret main effects
- **Non-parallel lines**: Interaction present → interpret carefully
- **Crossing lines**: Strong interaction → main effects misleading

---

## ⚙️ Semiconductor Applications

### Tool Matching Study

```text
H₀: μ₁ = μ₂ = μ₃ = μ₄  (all tools equivalent)
Design: Balanced, randomized assignment
Analysis: One-way ANOVA + Tukey post-hoc
Criterion: Differences < engineering tolerance
```

### Process Optimization (2ᵏ Design)

```text
Factors: k process parameters (2 levels each)
Runs: 2ᵏ experiments (+ center points)
Model: y = β₀ + Σβᵢxᵢ + ΣΣβᵢⱼxᵢxⱼ + ε
Goal: Identify significant effects
```

### Gauge R&R Analysis

```text
Components:
- Repeatability: Same operator variability
- Reproducibility: Between operator variability  
- Part-to-part: True process variation
Target: %R&R < 10% (excellent), < 30% (acceptable)
```

---

## 🚨 Troubleshooting Guide

### Problem: ANOVA Not Significant, But Groups Look Different

**Causes**: Low power, high within-group variance, outliers

**Solutions**:

- Increase sample size
- Remove outliers
- Use blocking to reduce error variance
- Check for non-linear relationships

### Problem: Significant ANOVA, No Significant Post-Hoc

**Causes**: Conservative post-hoc correction, multiple small differences

**Solutions**:

- Use less conservative post-hoc (Fisher LSD)
- Plan specific contrasts
- Report effect sizes and confidence intervals

### Problem: Assumptions Violated

**Solutions by Violation**:

- **Non-normality**: Log transform, use Kruskal-Wallis
- **Unequal variances**: Welch ANOVA, robust methods
- **Non-independence**: Mixed-effects models, GLS

### Problem: Significant Interaction, Can't Interpret

**Solutions**:

- Plot interaction graphs
- Analyze simple effects (one factor at each level of other)
- Use contrast coding
- Consider three-way interactions

---

## 🔧 Quick Commands (Python)

### One-Way ANOVA Commands

```python
from scipy.stats import f_oneway
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm

# Basic test
groups = [data[data['tool']==t]['yield'] for t in tools]
f_stat, p_value = f_oneway(*groups)

# Detailed analysis
model = ols('yield ~ C(tool)', data=data).fit()
anova_table = anova_lm(model, typ=2)
```

### Post-Hoc Test Commands

```python
from statsmodels.stats.multicomp import pairwise_tukeyhsd

tukey_results = pairwise_tukeyhsd(data['yield'], data['tool'])
print(tukey_results)
```

### Assumption Test Commands

```python
from scipy.stats import shapiro, levene

# Normality
shapiro_stat, shapiro_p = shapiro(residuals)

# Equal variances
levene_stat, levene_p = levene(*groups)
```

### Power Analysis Commands

```python
from statsmodels.stats.power import FTestAnovaPower

power_calc = FTestAnovaPower()
n_required = power_calc.solve_power(
    effect_size=0.25, alpha=0.05, power=0.80, k_groups=4
)
```

---

## 📊 Effect Size Guidelines

### Cohen's Conventions

| **η²** | **Cohen's f** | **Interpretation** | **Example** |
|--------|---------------|-------------------|-------------|
| 0.01 | 0.10 | Small | Tool differences within spec |
| 0.06 | 0.25 | Medium | Noticeable process improvement |
| 0.14 | 0.40 | Large | Major process change needed |

### Practical Significance

```text
Statistical significance ≠ Practical importance

Consider:
- Engineering tolerances
- Cost of implementation  
- Business impact
- Risk assessment
```

---

## 🎯 Decision Tree

```text
Start: Do you want to compare group means?
├─ YES: Continue
└─ NO: Use regression/correlation

How many groups?
├─ 2 groups: Use t-test
├─ 3+ groups: Continue
└─ Continuous predictor: Use regression

How many factors?
├─ 1 factor: One-way ANOVA
├─ 2-3 factors: Multi-way ANOVA
└─ 4+ factors: Factorial design

Are assumptions met?
├─ YES: Proceed with ANOVA
├─ NO (normality): Kruskal-Wallis
├─ NO (equal variance): Welch ANOVA
└─ NO (independence): Mixed-effects model

Is ANOVA significant?
├─ YES: Post-hoc tests
└─ NO: Check power, effect size

Practical significance?
├─ YES: Implement changes
└─ NO: Cost-benefit analysis
```

---

## 🚀 Best Practices

### Experimental Design

1. **Plan first**: Define hypotheses, calculate sample sizes
2. **Randomize**: Control order effects and bias
3. **Block**: Account for known sources of variation
4. **Replicate**: Enable error estimation and increase power

### Analysis Strategy

1. **Explore first**: Descriptive statistics, plots
2. **Check assumptions**: Don't skip this step
3. **Report effect sizes**: Not just p-values
4. **Use confidence intervals**: Show uncertainty

### Manufacturing Context

1. **Consider costs**: Statistical vs practical significance
2. **Document everything**: Reproducible analyses
3. **Validate results**: Independent confirmation
4. **Monitor over time**: Trends and drift

---

## 📚 Common Mistakes to Avoid

❌ **Multiple t-tests instead of ANOVA** → Inflated Type I error  
❌ **Ignoring interactions** → Misinterpreted main effects  
❌ **No assumption checking** → Invalid conclusions  
❌ **Fishing for significance** → Multiple testing issues  
❌ **Confusing statistical and practical significance** → Poor decisions  
❌ **Unbalanced designs without justification** → Reduced power  
❌ **Post-hoc tests without significant ANOVA** → Inappropriate  

---

## 🔗 Next Steps

**Module 3.1**: Regression Analysis for Process Engineers

- Predictive modeling
- Continuous variable relationships  
- Process optimization
- Model validation

**Advanced Topics**:

- Mixed-effects models
- Repeated measures
- Multivariate ANOVA (MANOVA)
- Bayesian ANOVA
